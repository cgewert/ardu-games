#include "TvGame.h"
#include "AnalogStickController.h"

byte gamestate = 0;
byte nextGamestate = 0;
TvGame game;
AnalogStickController controller;

int8_t posX = 0;
int8_t posY = 0;
int8_t sizeX = 8;
int8_t sizeY = 8;

/**
 * Made with Marlin Bitmap Converter
 * https://marlinfw.org/tools/u8glib/converter.html
 *
 * This bitmap from the file 'title3.png'
 */
#pragma once

#define TTSFJQ_BMPWIDTH  128

const unsigned char titleGfx[] PROGMEM = {
  128, 64,
  0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00, // ................................................................................................................................
  0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00, // ................................................................................................................................
  0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00, // ................................................................................................................................
  0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00, // ................................................................................................................................
  0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x55,0x40,0x00,0x00,0x00,0x00,0x00,0x00,0x00, // .........................................................#.#.#.#.#..............................................................
  0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x24,0x54,0x00,0x00,0x00,0x00,0x00,0x00,0x00, // ..........................................................#..#...#.#.#..........................................................
  0x00,0x00,0x00,0x00,0x00,0x00,0x01,0x53,0x22,0x00,0x00,0x00,0x00,0x00,0x00,0x00, // .......................................................#.#.#..##..#...#.........................................................
  0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x2A,0xA9,0x00,0x00,0x00,0x00,0x00,0x00,0x00, // ..........................................................#.#.#.#.#.#..#........................................................
  0x00,0x00,0x00,0x00,0x00,0x00,0x02,0xAA,0xAA,0x40,0x00,0x00,0x00,0x00,0x00,0x00, // ......................................................#.#.#.#.#.#.#.#.#..#......................................................
  0x00,0x00,0x00,0x00,0x00,0x00,0x08,0xAA,0xD5,0x50,0x00,0x00,0x00,0x00,0x00,0x00, // ....................................................#...#.#.#.#.##.#.#.#.#.#....................................................
  0x00,0x00,0x00,0x00,0x00,0x00,0x25,0x5F,0x6A,0x20,0x00,0x00,0x00,0x00,0x00,0x00, // ..................................................#..#.#.#.#####.##.#.#...#.....................................................
  0x00,0x00,0x00,0x00,0x00,0x00,0x92,0xAF,0xFB,0x54,0x00,0x00,0x00,0x00,0x00,0x00, // ................................................#..#..#.#.#.#########.##.#.#.#..................................................
  0x00,0x00,0x00,0x00,0x00,0x00,0x55,0x7F,0xF6,0xA0,0x00,0x00,0x00,0x00,0x00,0x00, // .................................................#.#.#.#.###########.##.#.#.....................................................
  0x00,0x00,0x00,0x00,0x00,0x00,0x15,0x7F,0xFF,0xAA,0x00,0x00,0x00,0x00,0x00,0x00, // ...................................................#.#.#.################.#.#.#.................................................
  0x00,0x00,0x00,0x00,0x00,0x02,0xAB,0xFF,0xFE,0xA8,0x00,0x00,0x00,0x00,0x00,0x00, // ..............................................#.#.#.#.#################.#.#.#...................................................
  0x00,0x00,0x00,0x00,0x00,0x00,0xAA,0xFF,0xFF,0xAA,0x80,0x00,0x00,0x00,0x00,0x00, // ................................................#.#.#.#.#################.#.#.#.#...............................................
  0x00,0x00,0x00,0x00,0x00,0x0A,0x57,0xFF,0xFF,0xD5,0x50,0x00,0x00,0x00,0x00,0x00, // ............................................#.#..#.#.#####################.#.#.#.#.#............................................
  0x00,0x00,0x00,0x00,0x02,0xAA,0xBF,0xFF,0xFF,0xFA,0xAA,0xA0,0x00,0x00,0x00,0x00, // ......................................#.#.#.#.#.#.###########################.#.#.#.#.#.#.#.....................................
  0x00,0x00,0x00,0x00,0x00,0x4A,0xAF,0xFF,0xFF,0xED,0x50,0x00,0x00,0x00,0x00,0x00, // .........................................#..#.#.#.#.#######################.##.#.#.#............................................
  0x00,0x00,0x00,0x00,0x00,0x22,0xAB,0xFF,0xFF,0xF5,0x4A,0x00,0x00,0x00,0x00,0x00, // ..........................................#...#.#.#.#.######################.#.#.#..#.#.........................................
  0x00,0x00,0x00,0x00,0x00,0x09,0x55,0xFF,0xFF,0x55,0x20,0x00,0x00,0x00,0x00,0x00, // ............................................#..#.#.#.#.#################.#.#.#.#..#.............................................
  0x00,0x00,0x00,0x00,0x00,0x00,0x2A,0xFF,0xFF,0x54,0x80,0x00,0x00,0x00,0x00,0x00, // ..................................................#.#.#.################.#.#.#..#...............................................
  0x00,0x00,0x00,0x00,0x00,0x00,0x95,0xBF,0xFA,0xA9,0x00,0x00,0x00,0x00,0x00,0x00, // ................................................#..#.#.##.###########.#.#.#.#..#................................................
  0x00,0x00,0x00,0x00,0x00,0x00,0x12,0xAF,0xFD,0x49,0x00,0x00,0x00,0x00,0x00,0x00, // ...................................................#..#.#.#.##########.#.#..#..#................................................
  0x00,0x00,0x00,0x00,0x00,0x00,0x2A,0xFF,0xFA,0xA4,0x00,0x00,0x00,0x00,0x00,0x00, // ..................................................#.#.#.#############.#.#.#..#..................................................
  0x00,0x00,0x00,0x00,0x00,0x01,0xAF,0xFF,0xFF,0xFB,0xA0,0x00,0x00,0x00,0x00,0x00, // ...............................................##.#.#########################.###.#.............................................
  0x00,0x00,0x00,0x00,0x00,0x5F,0xFF,0xFF,0xFF,0xFF,0xFD,0x00,0x00,0x00,0x00,0x00, // .........................................#.###########################################.#........................................
  0x00,0x00,0x00,0x00,0x0B,0x7F,0xFF,0xFF,0xFF,0xFF,0xFF,0xD0,0x00,0x00,0x00,0x00, // ....................................#.##.#################################################.#....................................
  0x00,0x00,0x00,0x00,0xB7,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFD,0x00,0x00,0x00,0x00, // ................................#.##.#########################################################.#................................
  0x00,0x00,0x00,0x02,0xFF,0xFE,0xAA,0xFF,0xFF,0xFF,0xFF,0xFF,0xA0,0x00,0x00,0x00, // ..............................#.###############.#.#.#.#.#########################################.#.............................
  0x00,0x00,0x00,0x3F,0xFF,0xFD,0xAD,0xFF,0xFF,0xFF,0xFD,0xFF,0xF8,0x00,0x00,0x00, // ..........................####################.##.#.##.###############################.##############...........................
  0x00,0x00,0x01,0x5F,0xDF,0xFF,0xD5,0xFF,0xFF,0xFF,0xFD,0x7F,0xFE,0x80,0x00,0x00, // .......................#.#.#######.###############.#.#.###############################.#.##############.#.......................
  0x00,0x00,0x0B,0xFA,0xBF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFA,0xAF,0xFF,0xA0,0x00,0x00, // ....................#.#######.#.#.###################################################.#.#.#.#############.#.....................
  0x00,0x00,0x57,0xDA,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0x55,0xFF,0xFC,0x00,0x00, // .................#.#.#####.##.#.########################################################.#.#.#.###############..................
  0x00,0x01,0x7D,0x55,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xD5,0xAF,0x7D,0x7E,0x80,0x00, // ...............#.#####.#.#.#.#.###################################################.#.#.##.#.####.#####.#.######.#...............
  0x00,0x02,0xED,0x56,0xEA,0xD6,0xBF,0xFF,0xFF,0xF5,0x6F,0xD5,0xBE,0xAF,0xA0,0x00, // ..............#.###.##.#.#.#.##.###.#.#.##.#.##.#.##########################.#.#.##.######.#.#.##.#####.#.#.#####.#.............
  0x00,0x1F,0xAA,0xAA,0x91,0xA5,0x5F,0xFF,0xFF,0xAA,0xB5,0x6A,0xD5,0x55,0xE8,0x00, // ...........######.#.#.#.#.#.#.#.#..#...##.#..#.#.#.######################.#.#.#.#.##.#.#.##.#.#.##.#.#.#.#.#.#.####.#...........
  0x00,0x5D,0x54,0x08,0x00,0x00,0xAB,0xFF,0xFF,0xAA,0x95,0x2D,0x76,0x95,0x7A,0x00, // .........#.###.#.#.#.#......#...................#.#.#.###################.#.#.#.#..#.#.#..#.##.#.###.##.#..#.#.#.####.#.........
  0x01,0xF5,0x40,0x00,0x40,0x00,0x57,0xFF,0xFF,0x52,0x24,0xD5,0xA8,0x25,0x5E,0x80, // .......#####.#.#.#...............#...............#.#.###################.#.#..#...#..#..##.#.#.##.#.#.....#..#.#.#.####.#.......
  0x02,0xAA,0x40,0x01,0x00,0x00,0x15,0xFF,0xFF,0xEA,0x8A,0x02,0xAA,0x84,0x4B,0xA0, // ......#.#.#.#.#..#.............#...................#.#.####################.#.#.#...#.#.......#.#.#.#.#.#....#...#..#.###.#.....
  0x1F,0x50,0x00,0x04,0x00,0x00,0x56,0xFF,0xFF,0x2A,0x16,0x05,0x54,0x01,0x2A,0xE8, // ...#####.#.#.................#...................#.#.##.################..#.#.#....#.##......#.#.#.#.#.........#..#.#.#.###.#...
  0x15,0x48,0x01,0x10,0x00,0x00,0x02,0xBF,0xF5,0x91,0x0B,0x01,0x17,0x50,0x02,0xBC, // ...#.#.#.#..#..........#...#..........................#.#.##########.#.##..#...#....#.##.......#...#.###.#.#..........#.#.####..
  0x75,0x20,0x02,0x00,0x00,0x00,0x15,0x55,0xAA,0x0C,0x07,0x02,0xB8,0x90,0x04,0xAE, // .###.#.#..#...........#............................#.#.#.#.#.#.##.#.#.#.....##.......###......#.#.###...#..#.........#..#.#.###.
  0xDA,0x80,0x00,0x00,0x00,0x00,0x00,0xAA,0xA0,0x02,0x03,0x85,0xCE,0x94,0x00,0x23, // ##.##.#.#...............................................#.#.#.#.#.#...........#.......###....#.###..###.#..#.#............#...##
  0xA8,0x00,0x00,0x00,0x50,0x00,0x01,0x2A,0xA0,0x18,0x01,0x0B,0x70,0x80,0x00,0x15, // #.#.#............................#.#...................#..#.#.#.#.#........##..........#....#.##.###....#..................#.#.#
  0xD4,0x0C,0x00,0x01,0x40,0x00,0x00,0x02,0x80,0x0D,0x00,0x82,0x1C,0x00,0x00,0x02, // ##.#.#......##.................#.#............................#.#...........##.#........#.....#....###........................#.
  0x20,0x00,0x00,0x0A,0x80,0x00,0x00,0xB4,0x40,0x20,0x00,0x04,0x03,0x00,0x00,0x01, // ..#.........................#.#.#.......................#.##.#...#........#..................#........##.......................#
  0xA0,0x00,0x00,0x2A,0x80,0x00,0x01,0xB2,0x10,0x00,0x00,0x40,0x00,0x00,0x00,0x00, // #.#.......................#.#.#.#......................##.##..#....#.....................#......................................
  0x28,0x00,0x05,0x50,0x40,0x00,0x06,0xE0,0xA8,0x04,0x00,0x00,0x00,0x00,0x00,0x00, // ..#.#................#.#.#.#.....#...................##.###.....#.#.#........#..................................................
  0xA8,0x00,0x00,0xA8,0x70,0x00,0x1B,0x64,0x28,0x02,0x80,0x04,0x00,0x00,0x00,0x00, // #.#.#...................#.#.#....###...............##.##.##..#....#.#.........#.#............#..................................
  0x74,0x00,0x12,0xA5,0x28,0x00,0x4B,0xA0,0x92,0x02,0x00,0x01,0x00,0x00,0x00,0x00, // .###.#.............#..#.#.#..#.#..#.#............#..#.###.#.....#..#..#.......#................#................................
  0x5A,0x00,0x02,0xD2,0xB8,0x01,0xAD,0x50,0x08,0x00,0x00,0x00,0x00,0x28,0x00,0x00, // .#.##.#...............#.##.#..#.#.###..........##.#.##.#.#.#........#.....................................#.#...................
  0x6A,0x00,0x0B,0xAB,0x48,0x05,0xE9,0x48,0x0C,0x00,0x00,0x40,0x00,0x20,0x00,0x00, // .##.#.#.............#.###.#.#.##.#..#........#.####.#..#.#..#.......##...................#................#.....................
  0xAD,0x09,0x56,0xEB,0xE4,0x0D,0xA8,0x48,0x02,0x00,0x00,0x00,0x00,0x01,0x00,0x00, // #.#.##.#....#..#.#.#.##.###.#.#####..#......##.##.#.#....#..#.........#........................................#................
  0x6A,0x54,0x6D,0xB7,0x42,0x1E,0x40,0x00,0x3D,0x00,0x00,0x00,0x00,0x00,0x00,0x00, // .##.#.#..#.#.#...##.##.##.##.###.#....#....####..#................####.#........................................................
  0xBB,0x06,0x36,0xD5,0x6B,0x9E,0x20,0x20,0x1F,0x80,0x00,0x00,0x03,0x82,0x80,0x00, // #.###.##.....##...##.##.##.#.#.#.##.#.###..####...#.......#........######.............................###.....#.#...............
  0xD4,0x81,0x49,0x2D,0x5F,0xFC,0x00,0x10,0x5E,0x00,0x00,0x00,0x00,0x02,0x00,0x00, // ##.#.#..#......#.#..#..#..#.##.#.#.###########.............#.....#.####.......................................#.................
  0x7E,0x80,0x0D,0xD5,0x7F,0xBE,0x00,0x11,0x48,0x00,0x00,0x00,0x00,0x20,0x00,0x00, // .######.#...........##.###.#.#.#.########.#####............#...#.#..#.....................................#.....................
  0x55,0x23,0x35,0x2B,0xFF,0xD0,0x20,0x02,0x08,0x00,0x00,0x10,0x00,0x00,0x00,0x00, // .#.#.#.#..#...##..##.#.#..#.#.############.#......#...........#.....#......................#....................................
  0x55,0xB5,0xAA,0x95,0x5D,0xD0,0x00,0x10,0x04,0x00,0x00,0x00,0x00,0x00,0x00,0x00, // .#.#.#.##.##.#.##.#.#.#.#..#.#.#.#.###.###.#...............#.........#..........................................................
  0xAA,0xAA,0x52,0x5B,0x55,0x40,0x00,0x00,0x08,0x00,0x80,0x00,0x00,0x00,0x00,0x00, // #.#.#.#.#.#.#.#..#.#..#..#.##.##.#.#.#.#.#..........................#...........#...............................................
  0xA8,0xAB,0x0A,0x95,0x55,0x70,0x00,0x00,0x00,0x00,0x80,0x00,0x00,0x00,0x00,0x00, // #.#.#...#.#.#.##....#.#.#..#.#.#.#.#.#.#.###....................................#...............................................
  0x55,0x54,0x00,0x0A,0xAA,0x80,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00, // .#.#.#.#.#.#.#..............#.#.#.#.#.#.#.......................................................................................
  0x05,0x54,0x00,0x05,0x08,0x20,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00  // .....#.#.#.#.#...............#.#....#.....#.....................................................................................
};

const unsigned char gameOverGfx[] PROGMEM = {
  128, 64,
  0x52,0x55,0x55,0x5B,0x6A,0xAD,0xAD,0xFF,0xEA,0x00,0x00,0x00,0x00,0x00,0x00,0x00, // .#.#..#..#.#.#.#.#.#.#.#.#.##.##.##.#.#.#.#.##.##.#.##.############.#.#.........................................................
  0xAA,0x92,0xAA,0xAA,0xAA,0xD6,0xD6,0xFF,0xF4,0x00,0x00,0x00,0x00,0x00,0x00,0x00, // #.#.#.#.#..#..#.#.#.#.#.#.#.#.#.#.#.#.#.##.#.##.##.#.##.############.#..........................................................
  0x2A,0xA9,0x2A,0xAA,0xAA,0xB5,0x5B,0x7F,0xF5,0x07,0xDD,0x00,0x00,0x00,0x00,0x00, // ..#.#.#.#.#.#..#..#.#.#.#.#.#.#.#.#.#.#.#.##.#.#.#.##.##.###########.#.#.....#####.###.#........................................
  0x52,0x54,0x95,0x55,0x55,0x56,0xD5,0xAE,0xFA,0x0B,0xFF,0x80,0x00,0x00,0x00,0x00, // .#.#..#..#.#.#..#..#.#.#.#.#.#.#.#.#.#.#.#.#.##.##.#.#.##.#.###.#####.#.....#.###########.......................................
  0x15,0x4A,0xA4,0xAA,0xAA,0xAB,0x6D,0xB7,0x7A,0x8A,0x9F,0xF8,0x00,0x00,0x00,0x00, // ...#.#.#.#..#.#.#.#..#..#.#.#.#.#.#.#.#.#.#.#.##.##.##.##.##.###.####.#.#...#.#.#..##########...................................
  0x42,0x54,0x95,0x55,0x55,0x55,0x55,0x6D,0xBD,0x77,0x57,0xFD,0x00,0x00,0x00,0x00, // .#....#..#.#.#..#..#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.##.##.##.####.#.###.###.#.#.#########.#................................
  0x29,0x12,0xA4,0x95,0x55,0x55,0x55,0xAD,0xDF,0x13,0xEA,0xFF,0xE0,0x00,0x00,0x00, // ..#.#..#...#..#.#.#..#..#..#.#.#.#.#.#.#.#.#.#.#.#.#.#.##.#.##.###.#####...#..#####.#.#.###########.............................
  0x54,0xA8,0x52,0x55,0x55,0x55,0x5A,0xB6,0xBE,0xA5,0xD5,0x1F,0xE0,0x00,0x00,0x00, // .#.#.#..#.#.#....#.#..#..#.#.#.#.#.#.#.#.#.#.#.#.#.##.#.#.##.##.#.#####.#.#..#.###.#.#.#...########.............................
  0x02,0x25,0x15,0x49,0x55,0x55,0x55,0x56,0xD7,0x51,0xFD,0xC5,0xF8,0x00,0x00,0x00, // ......#...#..#.#...#.#.#.#..#..#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.##.##.#.###.#.#...#######.###...#.######...........................
  0x49,0x52,0xA4,0xA5,0x2A,0xAA,0xAA,0xB5,0x6F,0x05,0xFF,0xF5,0x7E,0x00,0x00,0x00, // .#..#..#.#.#..#.#.#..#..#.#..#.#..#.#.#.#.#.#.#.#.#.#.#.#.##.#.#.##.####.....#.#############.#.#.######.........................
  0x24,0x48,0x12,0x95,0x55,0x55,0x55,0x5B,0xAB,0x25,0x3F,0xFA,0xBF,0x00,0x00,0x00, // ..#..#...#..#......#..#.#..#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.##.###.#.#.##..#..#.#..###########.#.#.######........................
  0x01,0x25,0x48,0xA2,0x4A,0xAA,0xAA,0xAA,0xDA,0x8A,0xBF,0xFD,0xFF,0x00,0x00,0x00, // .......#..#..#.#.#..#...#.#...#..#..#.#.#.#.#.#.#.#.#.#.#.#.#.#.##.##.#.#...#.#.#.############.#########........................
  0x00,0xA0,0x4A,0x29,0x29,0x55,0x55,0x55,0x6C,0xA2,0x05,0xFE,0xBF,0x80,0x00,0x00, // ........#.#......#..#.#...#.#..#..#.#..#.#.#.#.#.#.#.#.#.#.#.#.#.##.##..#.#...#......#.########.#.#######.......................
  0x05,0x10,0xA2,0x94,0x94,0x95,0x55,0x55,0xAA,0x40,0x52,0xFC,0xBF,0x80,0x00,0x00, // .....#.#...#....#.#...#.#..#.#..#..#.#..#..#.#.#.#.#.#.#.#.#.#.##.#.#.#..#.......#.#..#.######..#.#######.......................
  0x00,0x92,0x28,0x42,0x45,0x52,0xAA,0xAA,0xAA,0x20,0x12,0x3E,0x8F,0x80,0x00,0x00, // ........#..#..#...#.#....#....#..#...#.#.#.#..#.#.#.#.#.#.#.#.#.#.#.#.#...#........#..#...#####.#...#####.......................
  0x00,0x08,0x82,0x95,0x29,0x2A,0x55,0x55,0x69,0x50,0xA5,0xDE,0x7F,0x80,0x00,0x00, // ............#...#.....#.#..#.#.#..#.#..#..#.#.#..#.#.#.#.#.#.#.#.##.#..#.#.#....#.#..#.###.####..########.......................
  0x00,0x00,0x40,0x90,0xA4,0x92,0xAA,0xAA,0xAC,0x10,0x10,0x5E,0x8F,0x80,0x00,0x00, // .................#......#..#....#.#..#..#..#..#.#.#.#.#.#.#.#.#.#.#.##.....#.......#.....#.####.#...#####.......................
  0x00,0x00,0x12,0x4A,0x12,0x49,0x2A,0xAA,0xB0,0x45,0x42,0xAE,0xBE,0x80,0x00,0x00, // ...................#..#..#..#.#....#..#..#..#..#..#.#.#.#.#.#.#.#.##.....#...#.#.#....#.#.#.###.#.#####.#.......................
  0x00,0x00,0x10,0x41,0x49,0x54,0xA5,0x55,0x58,0x20,0x00,0xAF,0x1F,0x80,0x00,0x00, // ...................#.....#.....#.#..#..#.#.#.#..#.#..#.#.#.#.#.#.#.##.....#.............#.#.####...######.......................
  0x00,0x00,0x00,0x94,0x24,0x25,0x2A,0xAA,0xA8,0x04,0x00,0x2E,0x3F,0x00,0x00,0x00, // ........................#..#.#....#..#....#..#.#..#.#.#.#.#.#.#.#.#.#........#............#.###...######........................
  0x00,0x00,0x00,0x02,0x92,0x94,0x92,0xA9,0x54,0x04,0x00,0x06,0x9F,0x80,0x00,0x00, // ..............................#.#..#..#.#..#.#..#..#..#.#.#.#..#.#.#.#.......#...............##.#..######.......................
  0x00,0x00,0x00,0x10,0x44,0x45,0x49,0x55,0x50,0x08,0x00,0x02,0x3F,0x00,0x00,0x00, // ...........................#.....#...#...#...#.#.#..#..#.#.#.#.#.#.#........#.................#...######........................
  0x00,0x00,0x00,0x05,0x12,0x51,0x25,0x2A,0x00,0x00,0x00,0x00,0x1F,0x00,0x00,0x00, // .............................#.#...#..#..#.#...#..#..#.#..#.#.#....................................#####........................
  0x00,0x00,0x04,0x00,0x04,0x8A,0x92,0x94,0x00,0x00,0x00,0x10,0x3E,0x00,0x00,0x00, // .....................#...............#..#...#.#.#..#..#.#..#.#.............................#......#####.........................
  0x00,0x10,0x00,0x20,0x04,0xA0,0x4A,0x50,0x00,0x40,0x00,0x1A,0x9E,0x00,0x00,0x00, // ...........#..............#..........#..#.#......#..#.#..#.#.............#.................##.#.#..####.........................
  0x00,0x00,0x00,0x00,0x02,0x15,0x21,0x10,0x00,0x80,0x00,0x15,0x7E,0x00,0x00,0x00, // ......................................#....#.#.#..#....#...#............#..................#.#.#.######.........................
  0x00,0x00,0x00,0x01,0x02,0x40,0x95,0x50,0x00,0x50,0x00,0x15,0x3C,0x00,0x00,0x00, // ...............................#......#..#......#..#.#.#.#.#.............#.#...............#.#.#..####..........................
  0x00,0x00,0x00,0x00,0x08,0x94,0x40,0x80,0x09,0x10,0x00,0x07,0xFC,0x00,0x00,0x00, // ....................................#...#..#.#...#......#...........#..#...#.................#########..........................
  0x00,0x00,0x00,0x00,0x00,0x00,0x2A,0x40,0x00,0x88,0x00,0x0B,0xFC,0x00,0x00,0x00, // ..................................................#.#.#..#..............#...#...............#.########..........................
  0x00,0x00,0x00,0x00,0x00,0x00,0x01,0x00,0x00,0x24,0x00,0x14,0xF8,0x00,0x00,0x00, // .......................................................#..................#..#.............#.#..#####...........................
  0x00,0x00,0x00,0x00,0x00,0x00,0x05,0x00,0x41,0x21,0x00,0x0A,0xF8,0x04,0x00,0x00, // .....................................................#.#.........#.....#..#....#............#.#.#####........#..................
  0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x80,0x24,0x00,0x00,0xB5,0x78,0x0F,0x00,0x00, // ........................................................#.........#..#..................#.##.#.#.####.......####................
  0x00,0x00,0x00,0x00,0x00,0x00,0x04,0x01,0x12,0x00,0x14,0xA1,0x1C,0x07,0xC0,0x00, // .....................................................#.........#...#..#............#.#..#.#....#...###.......#####..............
  0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x02,0x08,0x00,0x01,0x44,0xAE,0x05,0xF0,0x00, // ..............................................................#.....#..................#.#...#..#.#.###......#.#####............
  0x00,0x00,0x00,0x00,0x00,0x00,0x0A,0x01,0x48,0x00,0x05,0x44,0x17,0x02,0xF8,0x00, // ....................................................#.#........#.#..#................#.#.#...#.....#.###......#.#####...........
  0x00,0x00,0x00,0x00,0x00,0x00,0x04,0x0E,0xA0,0x2C,0x02,0x10,0x4B,0x01,0xF8,0x00, // .....................................................#......###.#.#.......#.##........#....#.....#..#.##.......######...........
  0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x02,0x38,0x23,0x80,0x94,0x2B,0x80,0x78,0x00, // ..............................................................#...###.....#...###.......#..#.#....#.#.###........####...........
  0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x0A,0xA0,0x00,0x41,0x40,0x8B,0x00,0xFC,0x00, // ............................................................#.#.#.#..............#.....#.#......#...#.##........######..........
  0x00,0x00,0x00,0x00,0x00,0x00,0x14,0x0A,0xA8,0x00,0x28,0xB4,0x09,0x14,0x1C,0x00, // ...................................................#.#......#.#.#.#.#.............#.#...#.##.#......#..#...#.#.....###..........
  0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x04,0xA1,0x40,0xA4,0xD2,0x52,0x05,0xF0,0x00, // .............................................................#..#.#....#.#......#.#..#..##.#..#..#.#..#......#.#####............
  0x00,0x00,0x00,0x00,0x00,0x00,0x01,0x56,0x14,0x28,0x14,0x79,0x20,0x22,0xF0,0x00, // .......................................................#.#.#.##....#.#....#.#......#.#...####..#..#.......#...#.####............
  0x00,0x00,0x00,0x00,0x00,0x00,0x2A,0x2D,0x23,0x42,0xA1,0x7C,0x80,0x42,0xA0,0x00, // ..................................................#.#.#...#.##.#..#...##.#....#.#.#....#.#####..#........#....#.#.#.............
  0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xAE,0x01,0x28,0x24,0xFF,0x40,0x28,0xC0,0x00, // ........................................................#.#.###........#..#.#.....#..#..########.#........#.#...##..............
  0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x26,0x01,0x00,0x29,0xFE,0xA0,0xAF,0xC0,0x00, // ..........................................................#..##........#..........#.#..########.#.#.....#.#.######..............
  0x00,0x00,0x00,0x00,0x00,0x00,0x04,0x36,0x40,0x00,0x28,0xFF,0xA0,0x57,0x80,0x00, // .....................................................#....##.##..#................#.#...#########.#......#.#.####...............
  0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x54,0x80,0x00,0x09,0xFD,0xC5,0x3F,0x00,0x00, // .........................................................#.#.#..#...................#..#######.###...#.#..######................
  0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x56,0x40,0x00,0x00,0xF8,0x74,0xAF,0x00,0x00, // .........................................................#.#.##..#......................#####....###.#..#.#.####................
  0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x54,0x80,0x00,0x0B,0xE1,0x95,0x7E,0x00,0x00, // .........................................................#.#.#..#...................#.#####....##..#.#.#.######.................
  0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x54,0x80,0x00,0x01,0xE0,0xD5,0xBE,0x00,0x00, // .........................................................#.#.#..#......................####.....##.#.#.##.#####.................
  0x00,0x00,0x00,0x00,0x00,0x00,0x01,0x77,0x05,0x00,0x01,0xE0,0x55,0x78,0x00,0x00, // .......................................................#.###.###.....#.#...............####......#.#.#.#.####...................
  0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x33,0xC1,0x00,0x01,0x60,0x54,0x00,0x00,0x00, // ..........................................................##..####.....#...............#.##......#.#.#..........................
  0x00,0x00,0x00,0x00,0x00,0x00,0x01,0x64,0x40,0x00,0x0A,0xC0,0x2A,0x00,0x00,0x00, // .......................................................#.##..#...#..................#.#.##........#.#.#.........................
  0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xA4,0x00,0x00,0x03,0xE0,0x15,0x00,0x00,0x00, // ........................................................#.#..#........................#####........#.#.#........................
  0x00,0x00,0x00,0x00,0x00,0x00,0x01,0x68,0x00,0x01,0x17,0x80,0x0A,0x00,0x00,0x00, // .......................................................#.##.#..................#...#.####...........#.#.........................
  0x00,0x00,0x00,0x00,0x00,0x00,0x01,0x2A,0x00,0xA0,0x8B,0xC0,0x0A,0x80,0x00,0x00, // .......................................................#..#.#.#.........#.#.....#...#.####..........#.#.#.......................
  0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x41,0x20,0x40,0x2F,0x00,0x05,0x00,0x00,0x00, // .........................................................#.....#..#......#........#.####.............#.#........................
  0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x21,0x2D,0x20,0x0B,0x00,0x01,0x40,0x00,0x00, // ..........................................................#....#..#.##.#..#.........#.##...............#.#......................
  0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x40,0x92,0x98,0x0B,0x80,0x02,0x80,0x00,0x00, // .........................................................#......#..#..#.#..##.......#.###.............#.#.......................
  0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x40,0x2A,0xAE,0x0B,0x80,0x00,0xA0,0x00,0x00, // .........................................................#........#.#.#.#.#.###.....#.###...............#.#.....................
  0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x95,0x50,0x17,0x00,0x00,0x40,0x00,0x00, // ................................................................#..#.#.#.#.#.......#.###.................#......................
  0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xA5,0x14,0x0F,0x00,0x00,0x50,0x00,0x00, // ................................................................#.#..#.#...#.#......####.................#.#....................
  0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x01,0x2A,0x00,0x3F,0x00,0x00,0x00,0x00,0x00, // ...............................................................#..#.#.#...........######........................................
  0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x92,0x02,0x2F,0x00,0x00,0x08,0x00,0x00, // ................................................................#..#..#.......#...#.####....................#...................
  0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x01,0x48,0x05,0xBE,0x00,0x00,0x00,0x00,0x00  // ...............................................................#.#..#........#.##.#####.........................................
};

const unsigned char spaceshipGfx[] PROGMEM = {
  8,8,
  B00110000, // ..##....
  B00101000, // ..#.#...
  B11110110, // ####.##.
  B10001011, // #...#.##
  B10001011, // #...#.##
  B11110110, // ####.##.
  B00101000, // ..#.#...
  B00110000  // ..##....
};

void setup() {
    game = TvGame();
    game.begin();
    controller = AnalogStickController();
    controller.begin();
    posX = game.width /2;
    posY = game.height /2;
}

void loop() {
    if (!game.nextFrame()) return;
    controller.updateControllerState();

    switch (gamestate) {

        // Title screen
        case 0:
            game.drawBitmap(0, 0, titleGfx);
            if (controller.justPressed(BUTTON_A)) {
                game.tone(500, 10);
                nextGamestate = 1;
            }
            break;

        // Main game
        case 1:
            game.clearScreen();
            if (controller.pressed(BUTTON_UP)) {
                if (posY > 0) posY--;
            } else if (controller.pressed(BUTTON_DOWN)) {
                if (posY + sizeY < game.height) posY++;
            }
            if (controller.pressed(BUTTON_LEFT)) {
                if (posX > 0) posX--;
            } else if (controller.pressed(BUTTON_RIGHT)) {
                if (posX + sizeX < game.width) posX++;
            }

            game.drawBitmap(posX, posY, spaceshipGfx);

            // Debug output
            //game.drawCenteredText(0, String(game.currentFps).c_str());
            //game.drawCenteredText(10, String(controller.currentState).c_str());
            //game.drawCenteredText(20, String(controller.getRelativeX()).c_str());
            //game.drawCenteredText(30, String(controller.getRelativeY()).c_str());

            if (controller.justPressed(BUTTON_A)) {
                nextGamestate = 2;
            }
            break;

        // Game over screen
        case 2:
            game.drawBitmap(0, 0, gameOverGfx);
            if (controller.justPressed(BUTTON_A)) {
                game.tone(500, 10);
                nextGamestate = 0;
            }
            break;
    }

    gamestate = nextGamestate;
}

